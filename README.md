# Содержание

- [Введение](#id1)
  - [Обзор](#id2)
  - [Текущий охват API](#id3)
  - [Ключевые улучшения](#id4)
    - [Выравнивание продуктовых линеек](#id5)
    - [Повышение эффективности капитала](#id6)
    - [Кредитование унифицированного аккаунта](#id7)
    - [Режим портфельной маржи](#id8)
    - [Стандарт именования интерфейсов API](#id9)
    - [Отмена ордеров по валюте расчетов](#id10)
    - [Добавление интерфейса страхового фонда](#id11)
    - [Улучшения читаемости документации API](#id12)
- [Руководство по интеграции](#id13)
  - [Ресурсы API и каналы поддержки](#id14)
  - [Аутентификация](#id15)
    - [Выбор типа API-ключа](#id16)
    - [HTTP-заголовки для аутентифицированных конечных точек](#id17)
    - [Создание запроса](#id18)
  - [Общие параметры ответа](#id19)
- [Различные режимы аккаунтов](#id20)
  - [Унифицированный аккаунт 2.0 (UTA 2.0)](#id21)
  - [Унифицированный аккаунт 1.0 (UTA 1.0)](#id22)
  - [Классический аккаунт](#id23)
  - [Определение режима аккаунта через API](#id24)
  - [Изменения в использовании API для UTA 2.0](#id25)

## Введение<p id="id1"></p>

### Обзор<p id="id2"></p>

API V5 приносит единообразие и эффективность в продуктовые линейки Bybit, объединяя Спот, Деривативы и Опционы в одном наборе спецификаций.

### Текущий охват API<p id="id3"></p>

<table class="iksweb">
		<tr>
			<td rowspan="2">OpenAPI Version</td>
			<td rowspan="2">Account Type</td>
			<td colspan="3">Linear</td>
			<td colspan="2">Inverse</td>
			<td rowspan="2">Spot</td>
			<td rowspan="2">Options</td>
		</tr>
		<tr>
			<td>USDT Perpetual</td>
			<td>USDC Perpetual</td>
			<td>USDC Futures</td>
			<td>Perpetual</td>
			<td>Futures</td>
		</tr>
		<tr>
			<td rowspan="2">V5</td>
			<td>Unified trading account</td>
			<td>✓</td>
			<td>✓</td>
			<td>✓</td>
			<td>✓</td>
			<td>✓</td>
			<td>✓</td>
			<td>✓</td>
		</tr>
		<tr>
			<td>Classic account</td>
			<td>✓</td>
			<td></td>
			<td></td>
			<td>✓</td>
			<td>✓</td>
			<td>✓</td>
			<td></td>
		</tr>
</table>

### Ключевые улучшения<p id="id4"></p>

#### Выравнивание продуктовых линеек<p id="id5"></p>

V5 унифицирует API различных торговых продуктов в один, предоставляя пользователям возможность торговать Спот, Деривативами и контрактами Опционов с помощью единого API, отличая транзакции через различные параметры ордеров. Следовательно, нет необходимости переключаться между множественными интерфейсами при построении различных продуктов – независимо от задач, таких как управление ордерами или запрос данных кошелька – поскольку один и тот же API может использоваться для запросов и возврата результатов.
Глобальный словарь в V5 уникально определен, чтобы избежать сценариев, где разные термины используются для одних и тех же целей или где один термин имеет множественные ссылки. Это упрощает процесс устранения неисправностей для пользователей.

Например, при создании ордера с `POST V5/order/create` пользователи могут указать `category=spot/linear/inverse/option` для создания множественных ордеров по различным продуктам.

#### Повышение эффективности капитала<p id="id6"></p>

V5 предоставляет пользователям возможность обновить аккаунты до единого аккаунта, что позволяет совместно использовать и кросс-использовать средства между спотовой торговлей, бессрочными контрактами USDT, бессрочными контрактами USDC и опционами. Пользователи также могут компенсировать прибыль и убытки по разным позициям, что дополнительно повышает эффективность использования капитала.

#### Кредитование унифицированного аккаунта<p id="id7"></p>

API V5 поддерживает кредитование в режиме унифицированного аккаунта. Пользователи могут заложить множественные активы в качестве залога, чтобы получить маржу для торговли по различным продуктам.
Например: Трейдер Alice открывает позицию по контракту BTCUSDT, рассчитанному в USDT, имея только активы BTC. Если возникает плавающий убыток, будет записан долг, и будет взиматься процент почасово.

#### Режим портфельной маржи<p id="id8"></p>

Унифицированные аккаунты теперь поддерживают комбинированную маржу между Обратными пожизненными, Обратными фьючерсами, USDT пожизненными, USDC пожизненными, USDC фьючерсами и Опционами.

#### Стандарт именования интерфейсов API<p id="id9"></p>

API V5 предлагает более ясные определения путей для улучшения ясности и снижения неоднозначности. Новая версия делит путь API на модули: рыночные данные, управление ордерами, управление позициями, управление аккаунтами, управление активами и другие.

`<host>/<version>/<product>/<module>`

`Пример: api.bybit.com/v5/market/recent-trade`

|Сегмент адреса	        |Описание                                                                                                             |
|-----------------------|---------------------------------------------------------------------------------------------------------------------|
|v5/market/           	|Свечи, стакан, тикер, платформенные транзакционные данные, базовые финансовые правила, правила контроля рисков       |
|v5/order/        	    |Управление ордерами                                                                                                  |
|v5/position/	        |Управление позициями                                                                                                 |
|v5/account/	        |Операции только для одного аккаунта – унифицированный фондовый аккаунт, ставки и т.д.                                |
|v5/asset/	            |Операции с несколькими аккаунтами — управление активами, управление фондами и т.д.                                   |
|v5/spot-lever-token/  	|Получить котировки по Leveraged Tokens на спотовом рынке, а также выполнения функции покупки и погашения (выкупа)    |
|v5/spot-margin-trade/  |Управление Маржинальной торговлей на Споте                                                                           |

#### Отмена ордеров по валюте расчетов<p id="id10"></p>

Пользователи могут отменить все ордера Деривативов, рассчитанные одной и той же валютой, с помощью `settleCoin`.

#### Добавление интерфейса страхового фонда<p id="id11"></p>

Это добавление интерфейса позволяет запрашивать страховой пул, который пользователи могут использовать для проверки обновлений страхового фонда на платформе Bybit.

#### Улучшения читаемости документации API<p id="id12"></p>

Документация API была пересмотрена и отредактирована для улучшения ясности и снижения путаницы. Любые части предыдущей документации, которые были неясны, были пересмотрены для предоставления лучших объяснений.

## Руководство по интеграции<p id="id13"></p>

> Совет:
> 
>Чтобы узнать больше о V5 API, пожалуйста, прочитайте [введение](#id1).

### Ресурсы API и каналы поддержки<p id="id14"></p>
- [Центр помощи](https://www.bybit.com/en/help-center/topic-list?language=en_US)
- [Официальный Python SDK](https://github.com/bybit-exchange/pybit)
- [Официальный Go SDK](https://github.com/bybit-exchange/bybit.go.api)
- [Официальный Java SDK](https://github.com/bybit-exchange/bybit-java-api)
- [Официальный .Net SDK](https://github.com/bybit-exchange/bybit.net.api)
- [Сообщественный Node.js SDK](https://www.npmjs.com/package/bybit-api)
- [Telegram - Группа обсуждения API](https://t.me/BybitAPI)
- [Discord](https://discord.gg/3ZDjGBNvKR)
- [Коллекция Postman](https://github.com/bybit-exchange/QuickStartWithPostman)
- [Примеры использования API](https://github.com/bybit-exchange/api-usage-examples)

### Аутентификация<p id="id15"></p>

>Информация:
>
>Пожалуйста, посетите [тестовую сеть](https://testnet.bybit.com/app/user/api-management) или [основную сеть](https://www.bybit.com/app/user/api-management) Bybit для генерации API-ключа.

Базовый эндпоинт REST API:
  - Тестовая сеть:
  `https://api-testnet.bybit.com`

  - Основная сеть (доступны оба эндпоинта):
  `https://api.bybit.com`
  `https://api.bytick.com`

>Важно:
>  - Пользователи из Нидерландов: используйте https://api.bybit.nl для основной сети
>  - Пользователи из Турции: используйте https://api.bybit-tr.com для основной сети
>  - Пользователи из Казахстана: используйте https://api.bybit.kz для основной сети
>  - Пользователи из Грузии: используйте https://api.bybitgeorgia.ge для основной сети
>  - Пользователи из ОАЭ: используйте https://api.bybit.ae для основной сети

#### Выбор типа API-ключа<p id="id16"></p>

API-ключи, сгенерированные системой:
API-ключ, созданный системой Bybit, работает с шифрованием HMAC. Вам будет предоставлена пара публичного и приватного ключей. Пожалуйста, относитесь к этой паре ключей как к паролям и храните их в безопасности.

  - Следуйте примерам [скриптов HMAC](https://github.com/bybit-exchange/api-usage-examples) для завершения процедуры шифрования.

Автоматически сгенерированные API-ключи:
API-ключи, созданные самостоятельно, работают с шифрованием RSA. Вы должны создать свои публичный и приватный ключи с помощью программного обеспечения, а затем предоставить только публичный ключ Bybit — приватный ключ мы никогда не храним.

  - Используйте [api-rsa-generator](https://github.com/bybit-exchange/api-rsa-generator) для создания RSA приватного и публичного ключей.
  - Следуйте примерам [скриптов RSA](https://github.com/bybit-exchange/api-usage-examples) для завершения процедуры шифрования.

#### HTTP-заголовки для аутентифицированных конечных точек<p id="id17"></p>

Следующие ключи HTTP-заголовков должны использоваться для аутентификации:

  - `X-BAPI-API-KEY` - API-ключ
  - `X-BAPI-TIMESTAMP` - временная метка UTC в миллисекундах
  - `X-BAPI-SIGN` - подпись, полученная из параметров запроса
  - `X-Referer` или `Referer` - заголовок только для пользователей брокера

Мы также предоставляем X-BAPI-RECV-WINDOW (единица измерения в миллисекундах, значение по умолчанию 5000) для указания срока действия HTTP-запроса. Он также используется для предотвращения повторных атак.

Меньшее значение `X-BAPI-RECV-WINDOW` более безопасно, но ваш запрос может завершиться неудачей, если время передачи превышает ваше `X-BAPI-RECV-WINDOW`.

>Внимание:
>
>Пожалуйста, убедитесь, что параметр timestamp соответствует следующему правилу:  
>`server_time - recv_window <= timestamp < server_time + 1000`  
>это означает, что ваш timestamp должен находиться в диапазоне: [server_time - recv_window; server_time + 1000)  
>server_time обозначает время сервера Bybit, которое можно запросить через эндпоинт [/v5/market/time](#).. Помните, что настоятельно рекомендуется использовать время локального устройства для timestamp и всегда держать его синхронизированным с NTP.

#### Создание запроса<p id="id18"></p>

>Совет:  
>Для помощи в диагностике сложных проблем сети вы можете рассмотреть добавление `cdn-request-id` в заголовки вашего запроса. Его значение должно быть уникальным для каждого запроса.

Основные шаги:

  1. Вычислите строку, которую хотите подписать, следующим образом:
     - Для GET-запросов:
       `timestamp + API key + recv_window + queryString`.
     - Для POST-запросов:
       `timestamp + API key + recv_window + jsonBodyString`.
  2. Используйте алгоритм **HMAC_SHA256** или **RSA_SHA256** для подписания строки из шага 1 и преобразуйте её в строку в нижнем регистре HEX для HMAC_SHA256 или base64 для RSA_SHA256, чтобы получить строковое значение  вашей подписи.
  3. Добавьте вашу подпись в заголовок `X-BAPI-API-KEY` и отправьте HTTP-запрос.

>Информация:  
>Примеры алгоритмов подписи можно найти [здесь](https://github.com/bybit-exchange/api-usage-examples).

Пример того, как создать простой текст для шифрования:
  - GET
    ```
    # правило:
    timestamp+api_key+recv_window+queryString
    
    # Примерные значения:
    timestamp = "1658384314791"
    api_key = "XXXXXXXXXX"
    recv_window = "5000"
    queryString = "category=option&symbol=BTC-29JUL22-25000-C"
    
    # Результирующая строка, которая должна быть подписана:
    "1658384314791XXXXXXXXXX5000category=option&symbol=BTC-29JUL22-25000-C"
    
    # Пример результирующей подписи для HMAC:
    "410e0f387bafb7afd0f1722c068515e09945610124fa11774da1da857b72f30b"
    ```
  - POST
    ```
    # правило:
    timestamp+api_key+recv_window+jsonBodyString
    
    # Примерные значения:
    timestamp = 1658385579423
    api_key = XXXXXXXXXX
    recv_window = 5000
    jsonBodyString = {"category": "option"}
    
    # Результирующая строка, которая должна быть подписана:
    1658385579423XXXXXXXXXX5000{"category": "option"}
    
    # Пример результирующей подписи для HMAC:
    "f0da71972ce1811c882ca5e3fd1779791fb1fed499bef40e5558e50259acfd66"
    ```

Примеры HTTP-запросов:
  - GET
    ```
    GET /v5/order/realtime?category=option&symbol=BTC-29JUL22-25000-C HTTP/1.1
    Host: api-testnet.bybit.com
    -H 'X-BAPI-SIGN: XXXXXXXXXX' \
    -H 'X-BAPI-API-KEY: xxxxxxxxxxxxxxxxxx' \
    -H 'X-BAPI-TIMESTAMP: 1658384431891' \
    -H 'X-BAPI-RECV-WINDOW: 5000'
    ```
  - POST
    ```
    POST /v5/order/create HTTP/1.1
    Host: api-testnet.bybit.com
    -H 'X-Referer: XXXXXXXXXX' \    [the header for broker users only]
    -H 'X-BAPI-SIGN: XXXXXXXXXX' \
    -H 'X-BAPI-API-KEY: xxxxxxxxxxxxxxxxxx' \
    -H 'X-BAPI-TIMESTAMP: 1658385589135' \
    -H 'X-BAPI-RECV-WINDOW: 5000' \
    -H 'Content-Type: application/json' \
    -d '{"category": "option"}'
    ```

### Общие параметры ответа<p id="id19"></p>

```
{
    "retCode": 0,
    "retMsg": "OK",
    "result": {},
    "retExtInfo": {},
    "time": 1671017382656
}
```

|Parameter  |Type	|Comments                                                                                                 |
|-----------|-------|---------------------------------------------------------------------------------------------------------|
|retCode    |number	|Код успеха/ошибки                                                                                        |
|retMsg     |string	|Сообщение успеха/ошибки. `"OK"`, `"success"`, `"SUCCESS"` или пустая строка указывают на успешный ответ  |
|result	    |Object |Результат бизнес-данных                                                                                  |
|retExtInfo |Object |Расширенная информация. В большинстве случаев это `{}`                                                   |
|time	    |number |Текущая временная метка (мс)                                                                             |

## Различные режимы аккаунтов<p id="id20"></p>

В настоящее время на платформе Bybit существует три режима аккаунтов: классический аккаунт, унифицированный аккаунт 1.0 и унифицированный аккаунт 2.0.

### Унифицированный аккаунт 2.0 (UTA 2.0)<p id="id21"></p>

Этот режим аккаунта является конечной версией унифицированного аккаунта, объединяющей инверсные контракты, USDT Perpetuals, USDT Futures, USDC Perpetuals, USDC Futures, спот и опционы в единую торговую систему. В режимах кросс-маржи и портфельной маржи маржа распределяется между всеми сделками.

### Унифицированный аккаунт 1.0 (UTA 1.0)<p id="id22"></p>

В этом режиме аккаунта сделки с инверсными контрактами ведутся в отдельном торговом счёте, и соответствующая маржинальная валюта должна быть внесена на «счёт инверсных производных» перед началом торговли. Маржа между инверсными контрактами и другими инструментами не распространяется и не делится. Сделки с USDT Perpetual, USDT Futures, USDC Perpetual, USDC Futures, спотом и опционами осуществляются внутри системы «унифицированной торговли».

### Классический аккаунт<p id="id23"></p>

В этом режиме аккаунта транзакции с контрактами и спотовые транзакции разделены. Транзакции с инверсными контрактами и USDT Perpetuals завершаются в "счёте производных", а спотовые транзакции — в "спотовом счёте".

### Определение режима аккаунта через API<p id="id24"></p>

Используйте ключ соответствующего аккаунта для вызова метода Get Account Info и посмотрите значение поля unifiedMarginStatus:

|Значение   |	Режим аккаунта                  |
|-----------|-----------------------------------|
|1      	|классический аккаунт               |
|3	        |UTA 1.0                            |
|4	        |UTA 1.0 (профессиональная версия)  |
|5	        |UTA 2.0                            |
|6	        |UTA 2.0 (профессиональная версия)  |

Примечание:
UTA и UTA (pro) — это по сути одинаковые режимы, но версия Pro имеет небольшое преимущество в производительности при торговле через API.

### Изменения в использовании API для UTA 2.0

<table class="iksweb">
		<tr>
			<td rowspan="2">Категория API</td>
			<td rowspan="2">API</td>
			<td>UTA 2.0</td>
			<td>UTA 1.0</td>
		</tr>
		<tr>
			<td>category=inverse</td>
			<td>category=inverse</td>
		</tr>
		<tr>
			<td>Market</td>
			<td><a href="#1">/v5/market/instruments-info</a></td>
			<td>"unifiedMarginTrade" имеет значение true после реализации UTA 2.0</td>
			<td>"unifiedMarginTrade" имеет значение false</td>
		</tr>
		<tr>
			<td rowspan="8">Trade</td>
			<td><a href="#1">/v5/order/create</a></td>
			<td>Инверсные фьючерсы больше не поддерживают hedge-мод, поэтому "positionIdx" всегда `0`</td>
			<td>Инверсные фьючерсы поддерживают hedge-мод, поэтому "positionIdx" может быть `0`, `1`, `2`</td>
		</tr>
		<tr>
			<td><a href="#1">/v5/order/realtime</a></td>
			<td>Для запроса заказов с конечным статусом используется `openOnly`=1, и сохраняются только последние 500 заказов</td>
			<td>Для запроса заказов с конечным статусом используется `openOnly`=2</td>
		</tr>
		<tr>
			<td><a href="#1">/v5/order/history</a></td>
			<td>1. `orderStatus` не передаётся, по умолчанию запрашиваются все конечные заказы<br>2. Поддерживаются параметры `baseCoin` и `settleCoin`<br>3. Запрос активных заказов не поддерживается, некоторые конечные заказы ограничены для запроса<br>4. Отменённые заказы сохраняются до 24 часов<br>5. Могут быть запрошены только заказы, созданные после обновления</td>
			<td>1. `orderStatus` не передаётся, по умолчанию запрашиваются активные и конечные заказы<br>2. Параметры `baseCoin` и `settleCoin` не поддерживаются<br>3. Активные заказы и различные конечные заказы всегда поддерживаются<br>4. Нет такого ограничения</td>
		</tr>
		<tr>
			<td><a href="#1">/v5/execution/list</a></td>
			<td>1. Поддерживает запрос по `baseCoin`<br>2. Возвращаемый `createType` имеет значение<br>3. Могут быть запрошены только транзакции, созданные после обновления</td>
			<td>1. Запрос по `baseCoin` не поддерживается<br>2. Возвращаемый `createType` всегда пустая строка `""`</td>
		</tr>
		<tr>
			<td><a href="#1">/v5/order/create-batch</a></td>
			<td>Поддерживает инверсные контракты</td>
			<td>Не поддерживает инверсные контракты</td>
		</tr>
		<tr>
			<td><a href="#1">/v5/order/amend-batch</a></td>
			<td>Поддерживает инверсные контракты</td>
			<td>Не поддерживает инверсные контракты</td>
		</tr>
		<tr>
			<td><a href="#1">/v5/order/cancel-batch</a></td>
			<td>Поддерживает инверсные контракты</td>
			<td>Не поддерживает инверсные контракты</td>
		</tr>
		<tr>
			<td><a href="#1">/v5/order/disconnected-cancel-all</a></td>
			<td>Поддерживает инверсные контракты; торговые заказы на инверсные будут отменены при срабатывании DCP</td>
			<td>Не поддерживает инверсные контракты; торговые заказы на инверсные не будут отменены при срабатывании DCP</td>
		</tr>
		<tr>
			<td rowspan="3">Pre-upgrade</td>
			<td><a href="#1">/v5/pre-upgrade/order/history</a></td>
			<td>Поддерживает запрос заказов, созданных при состоянии классического аккаунта или унифицированного аккаунта 1.0</td>
			<td>-</td>
		</tr>
		<tr>
			<td><a href="#1">/v5/pre-upgrade/execution/list</td>
			<td>Поддерживает запрос транзакций, созданных при состоянии классического аккаунта или унифицированного аккаунта 1.0</td>
			<td>-</td>
		</tr>
		<tr>
			<td><a href="#1">/v5/pre-upgrade/position/closed-pnl</a></td>
			<td>Поддерживает запрос закрытого PnL, созданного при состоянии классического аккаунта или унифицированного аккаунта 1.0</td>
			<td>-</td>
		</tr>
		<tr>
			<td rowspan="5">Position</td>
			<td><a href="#1">/v5/position/list</a></td>
			<td>1. Передача нескольких символов не поддерживается<br>2. В ответе изменились значения или использование полей `tradeMode`, `liqPrice`, `bustPrice`</td>
			<td>1. Поддерживает передачу нескольких символов</td>
		</tr>
		<tr>
			<td><a href="#1">/v5/position/closed-pnl</a></td>
			<td>Может быть запрошен только закрытый PnL, созданный после обновления</td>
			<td>-</td>
		</tr>
		<tr>
			<td><a href="#1">/v5/position/set-leverage</a></td>
			<td>Инверсные perpetual и инверсные фьючерсы поддерживают только односторонний режим позиций, и плечо(leverage) для buy и sell должны быть равны</td>
			<td>Инверсные фьючерсы поддерживают hedge-режим позиций, и плечо(leverage) для buy и sell могут быть неравными</td>
		</tr>
		<tr>
			<td><a href="#1">/v5/position/switch-isolated</a></td>
			<td>Режим маржи стал на уровне аккаунта, этот интерфейс больше не применим</td>
			<td>Инверсные контракты поддерживают использование этого интерфейса</td>
		</tr>
		<tr>
			<td><a href="#1">/v5/position/switch-mode</a></td>
			<td>Инверсные фьючерсы больше не поддерживают hedge-режим позиций</td>
			<td>Инверсные фьючерсы поддерживают hedge-режим позиций</td>
		</tr>
		<tr>
			<td rowspan="3">Account</td>
			<td><a href="#1">/v5/account/wallet-balance</a></td>
			<td>Не поддерживает accountType=CONTRACT</td>
			<td>Поддерживает accountType=CONTRACT</td>
		</tr>
		<tr>
			<td><a href="#1">/v5/account/transaction-log</a></td>
			<td>Журналы транзакций для инверсных контрактов будут включены</td>
			<td>Журнал транзакций инверсного контракта необходимо получать через интерфейс ниже</td>
		</tr>
		<tr>
			<td><a href="#1">/v5/account/contract-transaction-log</a></td>
			<td>После обновления до UTA 2.0 этот интерфейс больше не применим</td>
			<td>Данные из UTA 1.0 или классического аккаунта могут быть получены</td>
		</tr>
		<tr>
			<td rowspan="2">Asset</td>
			<td><a href="#1">/v5/asset/delivery-record</a></td>
			<td>Поддерживает записи доставки инверсных фьючерсов</td>
			<td>Не поддерживает записи доставки инверсных фьючерсов</td>
		</tr>
		<tr>
			<td>Все интерфейсы, включающие `accountType` в этом каталоге</td>
			<td>CONTRACT больше не поддерживается, поскольку "inverse derivatives account" больше не существует</td>
			<td>Поддерживает CONTRACT (inverse derivatives account)</td>
		</tr>
		<tr>
			<td rowspan="2">WebSocket Stream/Trade</td>
			<td><a href="#1">wss://stream.bybit.com/v5/trade</a></td>
			<td>Поддерживает инверсные контракты</td>
			<td>Не поддерживает инверсные контракты</td>
		</tr>
</table>
