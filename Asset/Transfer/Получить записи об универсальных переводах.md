- [Информация](#информация)
- [Конечная точка](#конечная-точка)
- [Примеры запроса](#примеры-запроса)
- [Параметры запроса](#параметры-запроса)
- [Пример ответа](#пример-ответа)
- [Параметры ответа](#параметры-ответа)

<a id="информация"></a>

Запрос записей универсального перевода

>Совет:
>
>- Поддерживаются как ключ API master-account, так и ключ API sub-account.
>- Для ключа API master-account требуется разрешение «SubMemberTransfer».
>- Для ключа API sub-account требуется разрешение «SubMemberTransferList».
<!-- -->
>Информация:  
>
>- Если `startTime` и `endTime` не указаны, API по умолчанию возвращает данные за последние 7 дней.
>- Если указан только `startTime`, API возвращает записи с `startTime` + 7 дней.
>- Если указан только `endTime`, API возвращает записи с `endTime` - 7 дней.
>- Если указаны оба параметра, максимальный допустимый диапазон составляет 7 дней (`endTime` - `startTime` ≤ 7 дней).

<a id="конечная-точка"></a>

## Конечная точка

`/v5/asset/transfer/query-universal-transfer-list`

<a id="примеры-запроса"></a>

## Примеры запроса

- HTTP

  ```http
  GET /v5/asset/transfer/query-universal-transfer-list?limit=1&cursor=eyJtaW5JRCI6MTc5NjU3OCwibWF4SUQiOjE3OTY1Nzh9 HTTP/1.1
  Host: api-testnet.bybit.com
  X-BAPI-SIGN-TYPE: 2
  X-BAPI-API-KEY: "<api_key от биржи bybit>"
  X-BAPI-SIGN: <подпись>
  X-BAPI-TIMESTAMP: 1672190762800
  X-BAPI-RECV-WINDOW: 5000
  ```

- собственная реализация

  ```python
  import time
  import hmac
  import hashlib
  import requests

  from urllib.parse import urlencode

  base_url = "https://api-testnet.bybit.com"
  end_point = "/v5/asset/transfer/query-universal-transfer-list"
  complete_request = base_url + end_point

  api_key = "<api_key от биржи bybit>"
  api_secret = "<api_secret от биржи bybit>"
  time_stamp = str(int(time.time() * 1000))
  recv_window = "5000"

  data = {
      "limit": 1,
      "cursor": "eyJtaW5JRCI6MTc5NjU3OCwibWF4SUQiOjE3OTY1Nzh9",
  }

  param_str = time_stamp + api_key + recv_window + urlencode(data)
  
  signature = hmac.new(
      key=secret_key.encode("utf-8"),
      msg=param_str.encode("utf-8"),
      digestmod=hashlib.sha256
  ).hexdigest()
  
  headers = {
    "X-BAPI-API-KEY": api_key,
    "X-BAPI-SIGN": signature,
    "X-BAPI-TIMESTAMP": time_stamp,
    "X-BAPI-RECV-WINDOW": recv_window,
  }

  response = requests.get(url=complete_request, headers=headers, json=data, timeout=10)

  print(response.json())
  ```

- pybit

  ```python
  from pybit.unified_trading import HTTP

  session = HTTP(
      testnet=True,
      api_key="<api_key от биржи bybit>",
      api_secret="<api_secret от биржи bybit>",
  )
  print(session.get_universal_transfer_records(
      limit=1,
      cursor="eyJtaW5JRCI6MTc5NjU3OCwibWF4SUQiOjE3OTY1Nzh9",
  ))
  ```

<a id="параметры-запроса"></a>

## Параметры запроса

|Параметр  	                  |Обязательный	 |Тип  	  |Комментарии       |По умолчанию|
|-----------------------------|--------------|--------|------------------|------------|
|transferId                   |нет           |string  |***UUID***.<br><br>Используйте тот, который вы сгенерировали в [Создать внутренний перевод](</Asset/Transfer/Создать внутренний перевод.md>).       |-   |
|coin                     |нет           |string  |***Название монеты***<br><br>Только заглавными буквами       |-   |
|[status](</19.Определения значений в запросах и ответах.md#transferStatus>)                       |нет           |string  |***Статус перевода***       |-   |
|startTime  	                  |нет	 |integer   	  |***Временная метка начала выборки (в миллисекундах)***<br><br>Примечание: логика запроса фактически эффективна на основе второго уровня                       |-   |
|endTime  	                  |нет	 |integer   	  |***Временная метка конца выборки (в миллисекундах)***<br><br>Примечание: логика запроса фактически эффективна на основе второго уровня                      |-   |
|limit      |нет  |integer  |***Ограничение размера данных на странице.***<br><br>[`1`, `50`]          |`20`  |
|cursor	    |нет  |string   |***Курсор.***<br><br>- Используйте значение `nextPageCursor` из ответа для получения следующей страницы набора результатов   |-      |

<a id="пример-ответа"></a>

## Пример ответа

```json
{
    "retCode": 0,
    "retMsg": "success",
    "result": {
        "list": [
            {
                "transferId": "universalTransfer_4c3cfe2f-85cb-11ed-ac09-9e37823c81cd_533285",
                "coin": "USDC",
                "amount": "1000",
                "timestamp": "1672134373000",
                "status": "SUCCESS",
                "fromAccountType": "UNIFIED",
                "toAccountType": "UNIFIED",
                "fromMemberId": "533285",
                "toMemberId": "592324"
            }
        ],
        "nextPageCursor": "eyJtaW5JRCI6MTc4OTYwNSwibWF4SUQiOjE3ODk2MDV9"
    },
    "retExtInfo": {},
    "time": 1672190763079
}
```

<a id="параметры-ответа"></a>

## Параметры ответа

|Параметр  |Тип       |Комментарии                                             |
|----------|----------|--------------------------------------------------------|
|list  |array      |Массив объектов                                            |
|transferId  |string    |Идентификатор перевода                                             |
|coin  |string    |Название монеты перевода                                             |
|amount  |string    |Переведенная сумма                                             |
|fromMemberId  |string    |UID учетной записи откуда будет производиться перевод                                             |
|toMemberId  |string    |UID учетной записи куда будет производиться перевод                                             |
|fromAccountType  |string    |Тип учетной записи откуда произведен перевод                                             |
|toAccountType  |string    |Тип учетной записи куда произведен перевод                                             |
|timestamp  |string    |Временная метка создания передачи (в миллисекундах)                                                 |
|[status](</19.Определения значений в запросах и ответах.md#transferStatus>)     |string      |Статус перевода   |
|nextPageCursor  |string       |Метка для следующей страницы (используется в параметре запроса `cursor` для пагинации)      |
