- [Информация](#информация)
- [Поток данных](#поток-данных)
- [Запрос](#запрос)
- [Примеры запроса](#примеры-запроса)
- [Параметры запроса](#параметры-запроса)
- [Пример ответа при удачной подписки](#пример-ответа-при-удачной-подписки)
- [Пример ответа](#пример-ответа)
- [Параметры ответа](#параметры-ответа)

<a id="информация"></a>

Подписка на размещение ордера

>Зона применения:  
>
>`spot` - спот  
>`option` - опцион  
>`linear` - контракт (расчет в USDT, USDC, ...)
>
> - `Perpetual` - контракт без даты экспирации
> - `Futures` - контракт с датой экспирации
>
>`inverse` - контракт (расчет в BTC, ETH, ...) !!! только [UTA2.0](<../13.Различные режимы аккаунтов.md#единый-торговый-аккаунт-2.0>)
>
> - `Perpetual` - контракт без даты экспирации
> - `Futures` - контракт с датой экспирации

<a id="поток-данных"></a>

## Поток данных

`order.create`
`order.amend`
`order.cancel`

<a id="запрос"></a>

## Запрос

```json
{
    "op": "order.create",
    "header": {
        "X-BAPI-TIMESTAMP": "1711001595207",
        "X-BAPI-RECV-WINDOW": "8000"
    },
    "args": [
        {
            "category": "linear",
            "symbol": "ETHUSDT",
            "side": "Buy",
            "orderType": "Market",
            "qty": "0.01"
        }
    ]
}
```

<a id="примеры-запроса"></a>

## Примеры запроса

- собственная реализация

  ```python
  import os
  import hmac
  import json
  import time
  import websocket

  url = "wss://stream-testnet.bybit.com/v5/trade"
  api_key = "<api_key от биржи bybit>"
  api_secret = "<api_secret от биржи bybit>"

  def on_message(ws, message):
      try:
          data = json.loads(message)
          print(f"Полученное сообщение: {message}")
      except json.JSONDecodeError:
          print(f"Не удалось распарсить сообщение: {message}")
          return

      if data.get("op") == "auth" and data.get("retMsg") == "OK":
          print("Аутентификация успешна. Размещаю ордер на покупку")
          time_stamp = str(int(time.time() * 1000))
          request_create_order = {
              "op": "order.create",
              "header": {
                  "X-BAPI-TIMESTAMP": time_stamp,
                  "X-BAPI-RECV-WINDOW": "5000"
              },
              "args": [
                  {
                      "category": "linear",
                      "symbol": "ETHUSDT",
                      "side": "Buy",
                      "orderType": "Market",
                      "qty": "0.01"
                  }
              ]
          }
          ws.send(json.dumps(request_create_order))

  def on_error(ws, error):
      print(f"Ошибка: {error}")

  def on_close(ws, close_status_code, close_msg):
      print(f"Соединение закрыто: {close_status_code} {close_msg}")

  def on_open(ws):
      print("Соединение открыто")
      expires = int((time.time() + 1) * 1000)
      signature = str(hmac.new(
          key=api_secret.encode("utf-8"),
          msg=f"GET/realtime{expires}".encode("utf-8"),
          digestmod="sha256"
      ).hexdigest())

      auth_request = {
          "op": "auth",
          "args": [
              api_key,
              expires,
              signature
          ]
      }
      ws.send(json.dumps(auth_request))

      print("Запрос аутентификации отправлен")

  def run_websocket():
      while True:
          ws = websocket.WebSocketApp(url)
          ws.on_message = on_message
          ws.on_error = on_error
          ws.on_close = on_close
          ws.on_open = on_open

          ws.run_forever(
              ping_interval=20,
              ping_timeout=5
          )

          print("Соединение потеряно. Попытка переподключения...")
          time.sleep(5)

  run_websocket()
  ```

<a id="параметры-запроса"></a>

## Параметры запроса

|Параметр  	                  |Обязательный	 |Тип  	  |Комментарии             |По умолчанию|
|-----------------------------|--------------|--------|------------------------|------------|
|Параметр  	                  |Обязательный	 |Тип  	  |Комментарии             |По умолчанию|
|Параметр  	                  |Обязательный	 |Тип  	  |Комментарии             |По умолчанию|
|Параметр  	                  |Обязательный	 |Тип  	  |Комментарии             |По умолчанию|

<a id="пример-ответа-при-удачной-подписки"></a>

## Пример ответа при удачной подписки

```json
{
    "retCode": 0,
    "retMsg": "OK",
    "op": "auth",
    "connId": "cnt5leec0hvan15eukcg-2t"
}
```

<a id="пример-ответа"></a>

## Пример ответа

```json
{
    "retCode": 0,
    "retMsg": "OK",
    "op": "order.create",
    "data": {
        "orderId": "a4c1718e-fe53-4659-a118-1f6ecce04ad9",
        "orderLinkId": ""
    },
    "retExtInfo": {},
    "header": {
        "X-Bapi-Limit": "10",
        "X-Bapi-Limit-Status": "9",
        "X-Bapi-Limit-Reset-Timestamp": "1711001595208",
        "Traceid": "38b7977b430f9bd228f4b19724794dfd",
        "Timenow": "1711001595209"
    },
    "connId": "cnt5leec0hvan15eukcg-2v"
}
```

<a id="параметры-ответа"></a>

## Параметры ответа

|Параметр  |Тип       |Комментарии                                             |
|----------|----------|--------------------------------------------------------|
|Параметр   |Тип      |Комментарии                                             |
|Параметр   |Тип      |Комментарии                                             |
|Параметр   |Тип      |Комментарии                                             |
