- [Информация](#информация)
- [Поток данных](#поток-данных)
- [Подписка](#подписка)
- [Примеры подписки](#примеры-подписки)
- [Пример ответа при удачной подписки](#пример-ответа-при-удачной-подписки)
- [Пример получаемых данных](#пример-получаемых-данных)
- [Параметры получаемых данных](#параметры-получаемых-данных)

<a id="информация"></a>

## Информация

Подписка на оповещения ADL и информацию о страховом пуле.

> Зона применения:  
>
> `linear` - контракт (расчет в USDT, USDC, ...)
>
> - `Perpetual` - контракт без даты экспирации
> - `Futures` - контракт с датой экспирации
>
> `inverse` - контракт (расчет в BTC, ETH, ...)
>
> - `Perpetual` - контракт без даты экспирации
> - `Futures` - контракт с датой экспирации

***Частота обновлений***

- 1 с.

***Доступные фильтры***

- `adlAlert.USDT` для бессрочных/поставочных контрактов USDT
- `adlAlert.USDC` для бессрочных/поставочных контрактов USDC
- `adlAlert.inverse` для обратных контрактов.

<a id="поток-данных"></a>

## Поток данных

`adlAlert.{coin}`

<a id="подписка"></a>

## Подписка

```json
{
    "op": "subscribe",
    "args": [
        "adlAlert.USDT"
    ]
}
```

<a id="примеры-подписки"></a>

## Примеры подписки

- собственная реализация

  ```python
  import json
  import time
  import websocket
  
  URL = "wss://stream-testnet.bybit.com/v5/public/linear"
  
  def on_message(ws, message):
      print(f"Полученное сообщение: {message}")
  
  def on_error(ws, error):
      print(f"Ошибка: {error}")
  
  def on_close(ws, close_status_code, close_msg):
      print(f"Соединение закрыто: {close_status_code} {close_msg}")
  
  def on_open(ws):
      print("Соединение открыто")
      request = {
          "op": "subscribe",
          "args": [
              "adlAlert.USDT"
          ]
      }
      ws.send(json.dumps(request))
  
  def run_websocket():
      while True:
          ws = websocket.WebSocketApp(URL)
          ws.on_message = on_message
          ws.on_error = on_error
          ws.on_close = on_close
          ws.on_open = on_open
  
          ws.run_forever(
              ping_interval=20,
              ping_timeout=5
          )
  
          print("Соединение потеряно. Попытка переподключения...")
          time.sleep(5)
  
  run_websocket()
  ```

<a id="пример-ответа-при-удачной-подписки"></a>

## Пример ответа при удачной подписки

```json
{
    "req_id": "",
    "success": true,
    "ret_msg": "",
    "op": "subscribe",
    "conn_id": "d427n9atbetr53r4s1eg-d2mt",
}
```

<a id="пример-получаемых-данных"></a>

## Пример получаемых данных

```json
{
  "topic": "adlAlert.USDT",
  "type": "snapshot",
  "ts": 1757736794000,
  "data": [
    {
      "c": "USDT",
      "s": "FWOGUSDT",
      "b": -5421.29889888,
      "mb": -5421.29889888,
      "i_pr": -0.3,
      "pr": 0,
      "adl_tt": 10000,
      "adl_sr": -0.25
    },
    {
      "c": "USDT",
      "s": "ZORAUSDT",
      "b": 19873.46255153,
      "mb": 19874.97612833,
      "i_pr": -0.3,
      "pr": 0.000174,
      "adl_tt": 10000,
      "adl_sr": -0.25
    }
  ]
}
```

<a id="параметры-получаемых-данных"></a>

## Параметры получаемых данных

| Параметр | Тип    | Комментарии                                                                                                                                                                                                                |
|----------|--------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| topic    | string | ***Название потока данных.***                                                                                                                                                                                              |
| type     | string | ***Тип данных.***<br><br>- `snapshot`                                                                                                                                                                                      |
| ts       | number | ***Метка времени (в миллисекундах), когда система генерирует данные.***                                                                                                                                                    |
| data     | object | ***Массив объектов.***                                                                                                                                                                                                     |
| c        | string | ***Токен пула страхования.***                                                                                                                                                                                              |
| s        | string | ***Название торговой пары.***                                                                                                                                                                                              |
| b        | string | ***Баланс фонда страхования.***<br><br>- Используется для определения срабатывания ADL<br>- Для общего пула страхования поле `b` будет обновляться по механизму T+1 и ежедневно в 00:00 UTC                                |
| mb       | string | **Устаревшее поле.**<br><br>- Всегда возвращает ""                                                                                                                                                                         |
| i_pr     | string | ***Пороговое значение коэффициента PnL для запуска ADL при просадке позиции.***<br><br>- ADL запускается, если коэффициент просадки позиции по данной торговой паре за последние 8 часов превышает это значение            |
| pr       | string | ***Коэффициент просадки позиции по инструменту за последние 8 часов.***<br><br>- Используется для определения того, должен ли быть запущен или остановлен механизм ADL                                                     |
| adl_tt   | string | ***Порог срабатывания ADL по просадке позиции.***<br><br>- Данное условие действует только при остатке страхового фонда, превышающем это значение. В этом случае просадка более n% за 8 часов может запустить механизм ADL |
| adl_sr   | string | ***Порог остановки ADL по просадке позиции.***<br><br>- ADL отключаеться, когда коэффициент просадки позиции по инструменту за 8 часов опускается ниже этого значения                                                      |
