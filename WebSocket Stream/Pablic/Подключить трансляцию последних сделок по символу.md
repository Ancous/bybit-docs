- [Информация](#информация)
- [Поток данных](#поток-данных)
- [Подписка](#подписка)
- [Примеры подписки](#примеры-подписки)
- [Пример ответа при удачной подписки](#пример-ответа-при-удачной-подписки)
- [Пример получаемых данных](#пример-получаемых-данных)
- [Параметры получаемых данных](#параметры-получаемых-данных)

<a id="информация"></a>

Подписка на ленту последних сделок.

После подписки вы будете получать уведомления о сделках в режиме реального времени.

>Примечание:
>
>`опция` использует baseCoin (BTC),

<a id="поток-данных"></a>

## Поток данных

`publicTrade.{symbol}`

<a id="подписка"></a>

## Подписка

```json
{
    "op": "subscribe",
    "args": [
        "publicTrade.BTCUSDT"
    ]
}
```

<a id="примеры-подписки"></a>

## Примеры подписки

- собственная реализация

  ```python
  import json
  import time
  import websocket
  
  URL = "wss://stream-testnet.bybit.com/v5/public/linear"
  
  def on_message(ws, message):
      print(f"Полученное сообщение: {message}")
  
  def on_error(ws, error):
      print(f"Ошибка: {error}")
  
  def on_close(ws, close_status_code, close_msg):
      print(f"Соединение закрыто: {close_status_code} {close_msg}")
  
  def on_open(ws):
      print("Соединение открыто")
      request = {
          "op": "subscribe",
          "args": [
              "publicTrade.BTCUSDT"
          ]
      }
      ws.send(json.dumps(request))
  
  def run_websocket():
      while True:
          ws = websocket.WebSocketApp(URL)
          ws.on_message = on_message
          ws.on_error = on_error
          ws.on_close = on_close
          ws.on_open = on_open
  
          ws.run_forever(
              ping_interval=20,
              ping_timeout=5
          )
  
          print("Соединение потеряно. Попытка переподключения...")
          time.sleep(5)
  
  run_websocket()
  ```

- pybit

  ```python
  from time import sleep

  from pybit.unified_trading import WebSocket

  ws = WebSocket(
      testnet=True,
      channel_type="linear",
  )

  def handle_message(message):
      print(message)

  ws.trade_stream(
      symbol="BTCUSDT",
      callback=handle_message
  )

  while True:
      sleep(1)
  ```

<a id="пример-ответа-при-удачной-подписки"></a>

## Пример ответа при удачной подписки

```json
{
    "success":true,
    "ret_msg": "",
    "conn_id": "d427n9atbetr53r4s1eg-d2mt",
    "req_id": "",
    "op": "subscribe"
}
```

<a id="пример-получаемых-данных"></a>

## Пример получаемых данных

```json
{
    "topic": "publicTrade.BTCUSDT",
    "type": "snapshot",
    "ts": 1672304486868,
    "data": [
        {
            "T": 1672304486865,
            "s": "BTCUSDT",
            "S": "Buy",
            "v": "0.001",
            "p": "16578.50",
            "L": "PlusTick",
            "i": "20f43950-d8dd-5b31-9112-a178eb6023af",
            "BT": false,
            "seq": 1783284617
        }
    ]
}
```

<a id="параметры-получаемых-данных"></a>

## Параметры получаемых данных

|Параметр  |Тип       |Комментарии                                             |
|----------|----------|--------------------------------------------------------|
|id        |string    |Идентификатор сообщения                                             |
|topic     |string    |Название потока данных                                             |
|type      |string    |Тип данных. `snapshot`                                             |
|ts        |number    |Метка времени (в миллисекундах), когда система генерирует данные                                             |
|data      |map       |Массив объектов. Отсортирован по времени, когда сделка была исполнена, в порядке возрастания.                  |
|T         |number    |Отметка времени (в миллисекундах), когда ордер был исполнен.                                             |
|s         |string    |Название символа.                                             |
|S         |string    |Сторона тейкера. `Buy`, `Sell`.                                             |
|v         |string    |Размер сделки.                                             |
|p         |string    |Цена сделки.                                             |
|L         |string    |Направление изменения цены. Уникальное поле для `perpetuals` и `futures`.                                             |
|i         |string    |Идентификатор сделки.                                             |
|BT        |boolean   |Является ли блок-сделкой или нет.                                             |
|RPI       |boolean   |Является ли RPI-сделкой или нет.                                             |
|seq       |integer   |Кросс-последовательность.                                             |
|mP        |string    |Маркет-цена, уникальное поле для `option`.                                             |
|iP        |string    |Индекс-цена, уникальное поле для `option`.                                             |
|mIv       |string    |Маркет-волатильность, уникальное поле для `option`.                                             |
|iv        |string    |Волатильность, уникальное поле для `option`.                                             |
