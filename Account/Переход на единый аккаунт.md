- [Информация](#информация)
- [Конечная точка](#конечная-точка)
- [Примеры запроса](#примеры-запроса)
- [Параметры запроса](#параметры-запроса)
- [Пример ответа](#пример-ответа)
- [Параметры ответа](#параметры-ответа)

<a id="информация"></a>

## Информация

> Важно:
>
> Заблокированные пользователи не могут обновить аккаунт до Единого аккаунта
<!-- -->
> Руководство по обновлению:
>
> - Проверьте текущий статус вашего аккаунта, вызвав
>   [Получить информацию об аккаунте](<Получить информацию об аккаунте.md>)
>
> - Если `unifiedMarginStatus`=`5` - это [UTA2.0](</13.Различные режимы аккаунтов.md#единый-торговый-аккаунт-2.0>),
>   вы можете вызвать конечную точку ниже для обновления до
>   [UTA2.0](</13.Различные режимы аккаунтов.md#единый-торговый-аккаунт-2.0>) Pro. Через некоторое время проверьте
>   [Получить информацию об аккаунте](<Получить информацию об аккаунте.md>), и если `unifiedMarginStatus`=`6`, то
>   аккаунт успешно обновлен до [UTA2.0](</13.Различные режимы аккаунтов.md#единый-торговый-аккаунт-2.0>) Pro.
<!-- -->
> Требования к уровню аккаунта:
>
> - Для master-аккаунта: обновление разрешено, если пользователь имеет уровень VIP или PRO.
>
> - Для sub-аккаунта: обновление разрешено, только если master-аккаунт  аккаунт имеет уровень VIP или PRO.
<!-- -->
> Информация:
>
> Теперь вы можете обновить классический аккаунт до единого аккаунта без закрытия позиций, но обратите внимание на
> следующее:
>
> - Избегайте обновления в следующие периоды:
>   - каждый час с 50-й минуты до 5-й минуты следующего часа
>
> - При обновлении с [UTA2.0](</13.Различные режимы аккаунтов.md#единый-торговый-аккаунт-2.0>) до
>   [UTA2.0](</13.Различные режимы аккаунтов.md#единый-торговый-аккаунт-2.0>) Pro: убедитесь, что:
>   - нет открытых ордеров
>
> - Во время обновления учётной записи данные потока Rest API/Websocket могут быть неточными, поскольку данные об
>   активах, связанных с учётной записью, находятся в состоянии обработки. Рекомендуется выполнять запросы и
>   использовать данные после завершения обновления.

<a id="конечная-точка"></a>

## Конечная точка

`/v5/account/upgrade-to-uta`

<a id="примеры-запроса"></a>

## Примеры запроса

- HTTP

  ```http
  POST /v5/account/upgrade-to-uta HTTP/1.1
  Host: api-testnet.bybit.com
  X-BAPI-API-KEY: "<api_key от биржи bybit>"
  X-BAPI-SIGN: <подпись>
  X-BAPI-TIMESTAMP: 1672125123533
  X-BAPI-RECV-WINDOW: 5000
  Content-Type: application/json

  {}
  ```

- собственная реализация

  ```python
  import time
  import hmac
  import hashlib
  import json
  import requests

  base_url = "https://api-testnet.bybit.com"
  end_point = "/v5/account/upgrade-to-uta"
  complete_request = base_url + end_point

  api_key = "<api_key от биржи bybit>"
  secret_key = "<secret_key от биржи bybit>"
  time_stamp = str(int(time.time() * 1000))
  recv_window = "5000"

  data = {}

  param_str = time_stamp + api_key + recv_window + json.dumps(data)
  
  signature = hmac.new(
      key=secret_key.encode("utf-8"),
      msg=param_str.encode("utf-8"),
      digestmod=hashlib.sha256
  ).hexdigest()
  
  headers = {
    "X-BAPI-API-KEY": api_key,
    "X-BAPI-SIGN": signature,
    "X-BAPI-TIMESTAMP": time_stamp,
    "X-BAPI-RECV-WINDOW": recv_window,
  }

  response = requests.post(url=complete_request, headers=headers, json=data, timeout=10)

  print(response.json())
  ```

- pybit

  ```python
  from pybit.unified_trading import HTTP

  session = HTTP(
      testnet=True,
      api_key="<api_key от биржи bybit>",
      api_secret="<secret_key от биржи bybit>",
  )
  print(session.upgrade_to_unified_trading_account())
  ```

<a id="параметры-запроса"></a>

## Параметры запроса

Отсутствуют

<a id="пример-ответа"></a>

## Пример ответа

```json
{
    "retCode": 0,
    "retMsg": "",
    "result": {
        "unifiedUpdateStatus": "FAIL",
        "unifiedUpdateMsg": {
            "msg": [
                "Update account failed. You have outstanding liabilities in your Spot account.",
                "Update account failed. Please close the usdc perpetual positions in USDC Account.",
                "unable to upgrade, please cancel the usdt perpetual open orders in USDT account.",
                "unable to upgrade, please close the usdt perpetual positions in USDT account."
            ]
        }
    },
    "retExtInfo": {},
    "time": 1672125124195
}
```

<a id="параметры-ответа"></a>

## Параметры ответа

| Параметр            | Тип    | Комментарии                                                                               |
|---------------------|--------|-------------------------------------------------------------------------------------------|
| unifiedUpdateStatus | string | ***Статус обновления.***<br><br>- `FAIL`<br>- `PROCESS`<br>- `SUCCESS`                    |
| unifiedUpdateMsg    | object | ***Сообщение об обновлении.***<br><br>- Если `PROCESS` или `SUCCESS`, возвращается `null` |
| msg                 | array  | ***Массив сообщений об ошибках.***<br><br>- Это поле будет только у `FAIL`                |
